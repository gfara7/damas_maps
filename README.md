# Damascus Delivery Planner

This project plans routes for last-mile deliveries around Damascus using:

- **OSRM** (Open Source Routing Machine) for realistic travel times.
- **Google OR-Tools** for vehicle routing with capacity constraints.
- An optional **Flask + Leaflet** frontend for manual stop entry and map visualisation.

## Prerequisites

- Docker Desktop (for OSRM).
- Python 3.11+ with `pip`.

Install Python packages:

```bash
pip install -r requirments.txt
```

Prepare and start OSRM (from the project root):

```bash
make -f MakeFile refresh   # download + extract + partition + customise
make -f MakeFile run       # start osrm/osrm-backend on http://localhost:5000
```

> `routes.geojson`, `map.html`, `driver_assignments.xlsx`, and the `routes_kml` folder are generated by the solver and ignored by Git.

## Batch Solver

`solve_vrp.py` already defines a depot plus **30 delivery stops** around Damascus and **four vans** (capacity 20 drops each). Run:

```bash
python solve_vrp.py
```

Outputs (written to the project root):

| File | Description |
| --- | --- |
| `routes.geojson` | GeoJSON feature collection for all stops and routes. |
| `map.html` | Interactive Leaflet map with depot, stops, and polylines. |
| `driver_assignments.xlsx` | Excel sheet listing each driver, stop order, ETA, and leg stats. |
| `routes_kml/van_x.kml` | Per-vehicle KML suitable for Google Maps / Earth import. |

Console output includes the assignment summary with stop order and ETAs.

## Interactive Frontend (optional)

To enter custom stops and visualise the plan in the browser, run:

```bash
python app.py
```

and open [http://localhost:8000](http://localhost:8000). The UI uses the same OSRM backend and solver logic.

## Next Steps

- Persist drivers, deliveries, and stops in a database (e.g., Postgres + SQLAlchemy).
- Expand the frontend to create/edit batches and assign vehicles dynamically.
- Enhance reporting (PDF manifests, SMS/email driver dispatch).


## Daily Batch CLI

Plan from a JSON file:

`
python plan_daily.py --input samples/daily_batch.sample.json --prefix daily
`

If ehicles are omitted in JSON, provide --trucks and --capacity:

`
python plan_daily.py -i my_batch.json --trucks 4 --capacity 20 --prefix 2025-10-20
`

Outputs written to the project root:
- <prefix>_routes.geojson
- <prefix>_assignments.xlsx
- <prefix>_kml/
- <prefix>_map.html

